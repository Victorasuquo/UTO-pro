# RAG-Powered GitHub README Analyzer

This Python script leverages GitHub APIs, LangChain, and AstraDB to search for GitHub repositories based on user-provided keywords, analyze the README files to match a given context, and optionally update a vector store for Retrieval Augmented Generation (RAG) functionality. Users can subsequently query the updated vector store via a tool-calling agent.

---

## Overview

- The script searches GitHub repositories using a query string.
- It fetches README files from the resulting repositories and filters them based on a specified context.
- It displays a summary (including a snippet) of matched repositories.
- Optionally, it updates an AstraDB vector store with the README content for question-answering functionality.
- The script utilizes LangChain components to create a tool-calling agent that can be queried interactively.

---

## Installation & Dependencies

Before running the script, install the following dependencies:

- Python 3.7+
- requests  
- python-dotenv  
- langchain_core
- langchain (and relevant submodules)
- langchain_openai
- langchain_astradb

You can install the Python packages (where available via pip) using:

```bash
pip install requests python-dotenv
# Also install LangChain and its related packages as per your project's instructions.
```

Additionally, you must create a `.env` file with the following environment variables:

- GITHUB_TOKEN  
- ASTRA_DB_API_ENDPOINT  
- ASTRA_DB_APPLICATION_TOKEN  
- ASTRA_DB_KEYSPACE (if applicable)

---

## Usage

Run the script from your command line:

```bash
python script_name.py
```

The script will prompt you to:

1. Enter keywords to search for GitHub repositories.
2. Enter a context string to match against the repository README files.
3. Optionally choose to update the RAG vector store with the matched repository information.
4. Interactively ask questions about the matched repositories (enter "q" to quit).

For example:

```
Enter keywords to search repositories: langchain
Enter the context to match in README files: retriever
Matched Repositories:
1. langchain (owner_name)
   URL: https://github.com/owner_name/langchain
   Description: A framework for LLM applications.
   README Snippet: <first 500 characters of README> 
---
...
Do you want to update the RAG with matched repositories? (y/N): y
Ask a question about matched repositories (q to quit): How is retrieval performed?
```

---

## Function/Class Documentation

### fetch_github(owner, repo, endpoint)

- **Purpose:**  
  Fetches data from a specified GitHub API endpoint for a repository.

- **Input Parameters:**  
  - owner (str): The GitHub username or organization name owning the repository.
  - repo (str): The name of the repository.
  - endpoint (str): The specific repository endpoint (e.g., "readme").

- **Return Value:**  
  - dict: JSON response from the GitHub API if the request is successful.
  - None: If the request fails, it prints an error message and returns None.

### fetch_github_repositories(query, max_results=7)

- **Purpose:**  
  Searches for GitHub repositories based on a query and returns a set number of results.

- **Input Parameters:**  
  - query (str): The search query for repository keywords.
  - max_results (int, optional): The maximum number of repository results to fetch (default is 7).

- **Return Value:**  
  - list: A list of repository items (dicts) returned by the GitHub search API.
  - list: An empty list if search fails.

### fetch_readme(owner, repo)

- **Purpose:**  
  Retrieves and decodes the README file for the given repository.

- **Input Parameters:**  
  - owner (str): GitHub username or organization name.
  - repo (str): Repository name.

- **Return Value:**  
  - str: Decoded README content as text if available.
  - str: An empty string if the README is not found or the fetch fails.

### analyze_repositories(query, context, max_results=7)

- **Purpose:**  
  Analyzes repositories by fetching README files and returns those that contain a specified context.

- **Input Parameters:**  
  - query (str): The search term for GitHub repositories.
  - context (str): The text snippet or keyword to search for within the README content.
  - max_results (int, optional): Maximum number of repositories to analyze (default is 7).

- **Return Value:**  
  - list: A list of dictionaries, each containing repository details (name, owner, URL, description, and a snippet from the README) for repositories matching the context.

### display_matched_repositories(matched_repos)

- **Purpose:**  
  Displays the list of repositories that match the given context along with details.

- **Input Parameters:**  
  - matched_repos (list): A list of repository dictionaries as generated by analyze_repositories.

- **Return Value:**  
  - None: Prints the details directly to the console.

### connect_to_vstore()

- **Purpose:**  
  Initializes and returns an AstraDB vector store to be used for RAG (Retrieval Augmented Generation) functionality.

- **Input Parameters:**  
  - None (relies on environment variables for configuration).

- **Return Value:**  
  - AstraDBVectorStore: An instance of the vector store configured with OpenAIEmbeddings.

---

## Code Walkthrough

1. **Environment Setup:**  
   - The script begins by importing required modules and loading environment variables using `load_dotenv()`.
   - The GitHub token is retrieved from the environment to authenticate API requests.

2. **GitHub API Functions:**  
   - `fetch_github`: Generalized function to query GitHub API endpoints.
   - `fetch_github_repositories`: Uses GitHub's search API to find repositories based on a query.
   - `fetch_readme`: Retrieves and decodes the README content from a specific repository.

3. **Repository Analysis:**  
   - `analyze_repositories`: Iterates through repositories, fetching README files and checking if they contain the specified context. Matched repositories are recorded with details.

4. **Displaying Results:**  
   - `display_matched_repositories`: Nicely formats and prints details of the repositories that match the context.

5. **Vector Store Connection:**  
   - `connect_to_vstore`: Sets up a connection to AstraDB using OpenAI embeddings. The namespace and other necessary tokens are pulled from environment variables.

6. **Main Script Execution:**  
   - The script prompts the user for search query and context.
   - Displays the matching repositories.
   - Optionally updates the AstraDB vector store:
     - Converts repository README snippets into document objects.
     - Attempts to clear the existing vector store collection and then adds new documents.
   - Sets up a retriever tool and integrates with LangChain agents to allow the user to ask questions about the matched repositories in an interactive loop. The loop continues until the user types "q" to quit.

---

## Example Output

An example session might look like:

```
Enter keywords to search repositories: langchain
Enter the context to match in README files: retriever
Matched Repositories:
1. langchain (some_owner)
   URL: https://github.com/some_owner/langchain
   Description: A framework for LLM applications.
   README Snippet: "# LangChain\n\nLangChain is designed for building applications..."
---
Do you want to update the RAG with matched repositories? (y/N): y
Ask a question about matched repositories (q to quit): How does the retriever work?
<Agent's response with relevant information extracted from the README snippets>
```

---

## Error Handling

- **GitHub API Requests:**  
  - Each API call (in `fetch_github` and `fetch_github_repositories`) checks the HTTP status code.
  - If the response status is not 200, an error message is printed and either `None` or an empty list is returned.

- **README Fetching:**  
  - The `fetch_readme` function checks whether the content is present in the response and handles decoding.
  - If a README is not found, an error message is printed and an empty string is returned.

- **Vector Store Deletion:**  
  - When attempting to delete the existing vector store collection before updating it, a try-except block is used to silently pass any errors without crashing the script.

- **User Interaction:**  
  - The interactive prompt loop checks for "q" to gracefully exit.

---

This documentation provides a structured explanation of the code, including its functionality, dependencies, usage instructions, and error handling mechanisms. Adjust the installation commands and dependency versions as per your project environment and package availability.